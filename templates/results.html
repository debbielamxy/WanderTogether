<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>WanderTogether - Travel Companion Recommendations</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <style>
      :root{ --bg:#f7f8fb; --card:#fff; --muted:#6b7280; --accent:#2b6cb0; --high:#16a34a; --mid:#f59e0b; --low:#ef4444; --field:#334155; --answer:#0f172a; --compat-high:#1e40af; --compat-mid:#6366f1; --compat-low:#6b7280 }
      body{font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;background:var(--bg);color:#0f172a;margin:0;padding:20px}
      .container{max-width:1200px;margin:16px auto}
      h1{font-size:24px;margin:0 0 12px}
      .subtitle{font-size:16px;color:var(--muted);margin-bottom:20px}
      .msg{background:#eef6ff;border-left:4px solid var(--accent);padding:10px;border-radius:6px;margin-bottom:12px;color:#0b4a6f}
      .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(350px,1fr));gap:16px}
      .card{background:var(--card);padding:16px;border-radius:10px;box-shadow:0 1px 6px rgba(2,6,23,0.06);display:flex;gap:12px}
      .left{flex:0 0 36px;display:flex;align-items:flex-start}
      .content{flex:1}
      .name{font-size:16px;font-weight:600;margin:0}
      .bio{font-size:13px;color:var(--muted);margin-top:8px}
      .meta-row{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
      .meta{font-size:13px;color:var(--muted)}
      .badge{font-size:12px;padding:4px 8px;border-radius:999px;color:#fff;display:inline-block}
      .alg-label{font-size:11px;color:#6b7280;font-style:italic;margin-top:4px}
      .alg-title{font-size:14px;font-weight:600;color:#374151;margin-bottom:4px}
      /* Trust badge colors */
      .trust-high{background:var(--high)}
      .trust-mid{background:var(--mid)}
      .trust-low{background:var(--low)}
      /* Compatibility badge colors (distinct from trust) */
      .compat-high{background:var(--compat-high)}
      .compat-mid{background:var(--compat-mid)}
      .compat-low{background:var(--compat-low)}
      label.match-row{display:flex;align-items:flex-start;gap:10px}
      input[type=checkbox]{width:20px;height:20px;margin-top:4px}
      button{background:var(--accent);color:#fff;padding:10px 14px;border-radius:8px;border:0;cursor:pointer}
      .small{font-size:13px;color:var(--muted)}
      .score-display{display:flex;gap:8px;align-items:center;margin-top:8px}
      .score-label{font-size:11px;color:var(--muted)}
    </style>
  </head>
  <body>
    <h1>üåç WanderTogether - Travel Companion Recommendations</h1>
    <div class="subtitle">Safety-Enhanced Empirical Hybrid Algorithm</div>
    
    <div class="msg" style="background:#f0f9ff;border-left:4px solid #0ea5e9;color:#0c4a6e">
      <strong>üéØ Top 8 Recommendations</strong> - Ranked by compatibility and trust scores
      <br>Feel free to select <span style="color:var(--high)">1</span> - <span style="color:var(--high)">8</span> travel companions you'd like to journey with.
    </div>
    
    {% if message %}
      <div class="msg">{{ message }}</div>
    {% endif %}
    
    <div class="container">
      {# maps to display friendly labels for budget, pace and style #}
      {% set budget_map = {1:'Economical',2:'Average',3:'Luxury', 'economical':'Economical','average':'Average','luxury':'Luxury'} %}
      {% set pace_map = {1:'Relaxed itinerary',2:'Spontaneous/No itinerary',3:'Packed itinerary', 'relaxed_itinerary':'Relaxed itinerary','spontaneous':'Spontaneous/No itinerary','packed_itinerary':'Packed itinerary'} %}
      {% set style_map = {'economical':'Economical','average':'Average','luxury':'Luxury'} %}
      
      <div style="margin-bottom:10px" class="small">Trust Score: Reliability and rating based on past interactions.</div>
      <div class="msg small" style="display:flex;gap:12px;align-items:center;flex-wrap:wrap">
        <div style="display:flex;gap:8px;align-items:center">
          <div class="badge trust-low">&lt;0.4</div>
          <div style="font-size:13px;color:var(--muted)">Match with caution</div>
        </div>
        <div style="display:flex;gap:8px;align-items:center">
          <div class="badge trust-mid">0.4‚Äì0.7</div>
          <div style="font-size:13px;color:var(--muted)">Moderate reliability</div>
        </div>
        <div style="display:flex;gap:8px;align-items:center">
          <div class="badge trust-high">‚â•0.7</div>
          <div style="font-size:13px;color:var(--muted)">High reliability</div>
        </div>
      </div>
      
      <div style="font-size:13px;color:var(--muted);margin-top:8px">Compatibility Score: How well the profile matches your preferences (excluding trust).</div>
      <div class="msg small" style="display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin-top:8px">
        <div style="display:flex;gap:8px;align-items:center">
          <div class="badge compat-low">&lt;0.4</div>
          <div style="font-size:13px;color:var(--muted)">Low compatibility</div>
        </div>
        <div style="display:flex;gap:8px;align-items:center">
          <div class="badge compat-mid">0.4‚Äì0.7</div>
          <div style="font-size:13px;color:var(--muted)">Moderate compatibility</div>
        </div>
        <div style="display:flex;gap:8px;align-items:center">
          <div class="badge compat-high">‚â•0.7</div>
          <div style="font-size:13px;color:var(--muted)">High compatibility</div>
        </div>
      </div>

    <form id="matchesForm" action="/submit_matches" method="post">
      <!-- user hidden fields -->
      <input type="hidden" name="name" value="{{ user.name }}" />
      <input type="hidden" name="age" value="{{ user.age }}" />
      <input type="hidden" name="gender" value="{{ user.gender }}" />
      <input type="hidden" name="budget" value="{{ user.budget }}" />
      <input type="hidden" name="travel_budget" value="{{ user.travel_budget if user.travel_budget is defined else user.budget }}" />
      <input type="hidden" name="cleanliness" value="{{ user.cleanliness }}" />
      <input type="hidden" name="dietary" value="{{ user.dietary }}" />
      <input type="hidden" name="alcohol" value="{{ user.alcohol }}" />
      <input type="hidden" name="smoking" value="{{ user.smoking }}" />
      <input type="hidden" name="fitness" value="{{ user.fitness }}" />
      <input type="hidden" name="pace" value="{{ user.pace }}" />
      <input type="hidden" name="pace_text" value="{{ user.pace_text }}" />
      <input type="hidden" name="style" value="{{ user.style }}" />
      {% for it in user.interests %}
        <input type="hidden" name="interests" value="{{ it }}" />
      {% endfor %}
      {% for s in user.sleep %}
        <input type="hidden" name="sleep" value="{{ s }}" />
      {% endfor %}
      <input type="hidden" name="bio" value="{{ user.bio }}" />

      <div class="grid">
      {% for profile, final_score, compatibility_score in recommendations %}
        <div class="card">
          <label class="match-row">
            <div class="left">
              <input type="checkbox" name="selected" value="{{ profile.id }}::{{ '%.4f'|format(final_score) }}::{{ '%.4f'|format(compatibility_score) }}::{{ '%.4f'|format(profile.trust if profile.trust is defined else 0.5) }}">
            </div>
            <div class="content">
              <div class="name">
                {{ profile.name }}
                <span style="font-weight:400;font-size:13px;color:var(--muted);margin-left:8px">¬∑ Age: {{ profile.age if profile.age is defined else '‚Äî' }}</span>
              </div>
              
              <div class="bio">{{ profile.bio }}</div>
              
              <div class="meta-row">
                <div class="meta">üí∞ {{ budget_map[profile.budget] if profile.budget in budget_map else profile.budget }}</div>
                <div class="meta">‚è±Ô∏è {{ pace_map[profile.pace] if profile.pace in pace_map else profile.pace }}</div>
                <div class="meta">üéØ {{ style_map[profile.style] if profile.style in style_map else profile.style }}</div>
              </div>
              
              {% if profile.interests and profile.interests|length > 0 %}
                <div class="meta-row">
                  <div class="meta">üé® {{ profile.interests[:3]|join(', ') }}{% if profile.interests|length > 3 %}...{% endif %}</div>
                </div>
              {% endif %}
              
              <div class="score-display">
                <div class="score-label">Final Score:</div>
                <div class="badge compat-high">{{ '%.3f'|format(final_score) }}</div>
              </div>
              
              <div class="score-display">
                <div class="score-label">Compatibility:</div>
                {% set compat_val = compatibility_score if compatibility_score is defined else 0.0 %}
                {% if compat_val >= 0.7 %}
                  <div class="badge compat-high">{{ '%.3f'|format(compat_val) }}</div>
                {% elif compat_val >= 0.4 %}
                  <div class="badge compat-mid">{{ '%.3f'|format(compat_val) }}</div>
                {% else %}
                  <div class="badge compat-low">{{ '%.3f'|format(compat_val) }}</div>
                {% endif %}
              </div>
              
              <div class="score-display">
                <div class="score-label">Trust:</div>
                {% set trust_val = (profile.trust if profile.trust is defined else 0.5) %}
                {% if trust_val >= 0.7 %}
                  <div class="badge trust-high">{{ '%.3f'|format(trust_val) }}</div>
                {% elif trust_val >= 0.4 %}
                  <div class="badge trust-mid">{{ '%.3f'|format(trust_val) }}</div>
                {% else %}
                  <div class="badge trust-low">{{ '%.3f'|format(trust_val) }}</div>
                {% endif %}
              </div>
            </div>
          </label>
        </div>
      {% endfor %}
      </div>

      <div style="margin-top:20px;text-align:center">
        <button type="submit">Submit Selected Companions</button>
        <div class="small" style="margin-top:8px">Select 1-8 travel companions you'd like to journey with</div>
      </div>
    </form>
    </div>

    <script>
      // Limit checkbox selections to 8
      document.querySelectorAll('input[name="selected"]').forEach(checkbox => {
        checkbox.addEventListener('change', function() {
          const checked = document.querySelectorAll('input[name="selected"]:checked');
          if (checked.length > 8) {
            this.checked = false;
            alert('You can select up to 8 companions only.');
          }
        });
      });
    </script>
  </body>
</html>
